<%= render "shared/header" %>

<%# 商品の概要 %>
<div class="item-show">
  <div class="item-box">
    <h2 class="name">
      <%= @sound.title%>
    </h2>
    <%= image_tag @sound.user.image ,class:"item-box-img" %>
      <audio src= "<%= @sound.file.url  %>" controls="" class="sound-audio">
       <a src= "<%= @sound.file.url %>">ダウンロード</a>
       <p>音声を再生するには、audioタグをサポートしたブラウザが必要です。</p>
      </audio>
    <%# <div class="item-price-box">
      <span class="item-price">
        ¥ 999,999,999
      </span>
      <span class="item-postage">
        (税込) 送料込み
      </span>
    </div> %>

    <%# ログインしているユーザーと出品しているユーザーが、同一人物の場合と同一人物ではない場合で、処理を分けましょう %>
    <% if  user_signed_in? && current_user.id == @sound.user_id %>
    <%= link_to '商品の編集', "#", method: :get, class: "item-red-btn" %>
    <p class='or-text'>or</p>
    <%= link_to '削除', "#", method: :delete, class:'item-destroy' %>
    <% end %>

    <%# 商品が売れていない場合はこちらを表示しましょう %>
    <%# <%= link_to '購入画面に進む', "#" ,class:"item-red-btn"%>
    <%# //商品が売れていない場合はこちらを表示しましょう %>

    <div class="item-explain-box">
      <span><%= @sound.text %></span>
    </div>
    <table class="detail-table">
      <tbody>
        <tr>
          <th class="detail-item">出品者</th>
          <td class="detail-value"><%= @sound.user.nickname %></td>
        </tr>
        <tr>
          <th class="detail-item">カテゴリー</th>
          <td class="detail-value"><%= @sound.genre.name %></td>
        </tr>

      </tbody>
    </table>
    <div>
        <% if current_user.already_liked?(@sound) %>
         <%= button_to 'いいねを取り消す', sound_like_path(@sound), method: :delete %>
        <% else %>
         <%= button_to 'いいね', sound_likes_path(@sound) %>
        <% end %>
     </div>
    
    <div class="option">
      <div class="favorite-btn">
        <%= image_tag "star.png" ,class:"favorite-star-icon" ,width:"20",height:"20"%>
        <span><%= @sound.likes.count %></span>
      </div>
    </div>

    <div>  
        <h3>いいねしたユーザー</h3>
        <% @sound.liked_users.each do |user| %>
         <li><%= user.nickname %></li>
        <% end %>
    </div>
  </div> 
  <%# /商品の概要 %>

  <div class="comment-box">
    <% if current_user %>
      <%= form_with model: [@sound,@comment], local: true do |f| %>
        <%= f.text_area :text, placeholder: "コメントする" %>
        <p class="comment-warn">
          相手のことを考え丁寧なコメントを心がけましょう。
          <br>
          不快な言葉遣いなどは利用制限や退会処分となることがあります。
        </p>
        <%= f.submit "SEND" %>
      <% end %>
      <%else %>
      <strong><p>※※※ コメントの投稿には新規登録/ログインが必要です ※※※</p></strong>
    <% end %>
  </div>
  <div class="comments">
      <h4>＜コメント一覧＞</h4>
      <% if @comments %>
        <% @comments.each do |comment| %>
          <p>
            <strong><%= link_to comment.user.nickname, "/users/#{comment.user_id}" %>：</strong>
            <%= comment.text %>
          </p>
        <% end %>
      <% end %>
    </div>
  <div class="links">
    <a href="#" class="change-item-btn">
      ＜ 前の商品
    </a>
    <a href="#" class="change-item-btn">
      後ろの商品 ＞
    </a>
  </div>
  <a href="#" class='another-item'><%= "商品のカテゴリー名" %>をもっと見る</a>
</div>

<%= render "shared/footer" %>
